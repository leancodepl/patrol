syntax = "proto3";
package patrol;

option java_package = "pl.leancode.automatorserver.contracts";

service NativeAutomator {
  // general

  rpc pressHome(PressHomeRequest) returns (PressHomeResponse) {}
  rpc pressBack(PressBackRequest) returns (PressBackResponse) {}
  rpc pressRecentApps(PressRecentAppsRequest)
      returns (PressRecentAppsResponse) {}
  rpc doublePressRecentApps(DoublePressRecentAppsRequest)
      returns (DoublePressRecentAppsResponse) {}
  rpc openApp(OpenAppRequest) returns (OpenAppResponse) {}
  rpc openNotifications(OpenNotificationsRequest)
      returns (OpenNotificationsResponse) {}
  rpc openQuickSettings(OpenQuickSettingsRequest)
      returns (OpenQuickSettingsResponse) {}

  // services

  rpc enableDarkMode(DarkModeRequest) returns (DarkModeResponse) {}
  rpc disableDarkMode(DarkModeRequest) returns (DarkModeResponse) {}
  rpc enableWiFi(WiFiRequest) returns (WiFiResponse) {}
  rpc disableWiFi(WiFiRequest) returns (WiFiResponse) {}
  rpc enableCellular(CellularRequest) returns (CellularResponse) {}
  rpc disableCellular(CellularRequest) returns (CellularResponse) {}

  // UI interaction

  rpc getNativeWidgets(GetNativeWidgetsRequest)
      returns (GetNativeWidgetsResponse) {}
  rpc getNotifications(GetNotificationsRequest)
      returns (GetNotificationsResponse) {}
  rpc tap(TapRequest) returns (TapResponse) {}
  rpc doubleTap(TapRequest) returns (TapResponse) {}
  rpc enterText(EnterTextRequest) returns (EnterTextResponse) {}
  rpc swipe(SwipeRequest) returns (SwipeResponse) {}
  rpc handlePermissionDialog(HandlePermissionRequest)
      returns (HandlePermissionResponse) {}
  rpc setLocationAccuracy(SetLocationAccuracyRequest)
      returns (SetLocationAccuracyResponse) {}
  rpc tapOnNotification(TapOnNotificationRequest)
      returns (TapOnNotificationResponse) {}
}

message PressHomeRequest {}
message PressHomeResponse {}

message PressBackRequest {}
message PressBackResponse {}

message PressRecentAppsRequest {}
message PressRecentAppsResponse {}

message DoublePressRecentAppsRequest {}
message DoublePressRecentAppsResponse {}

message OpenAppRequest { string appId = 1; }
message OpenAppResponse {}

message OpenNotificationsRequest {}
message OpenNotificationsResponse {}

message TapOnNotificationRequest {
  oneof findBy {
    uint32 index = 1;
    Selector selector = 2;
  }
}
message TapOnNotificationResponse {}

message OpenQuickSettingsRequest {}
message OpenQuickSettingsResponse {}

message DarkModeRequest { string appId = 1; }
message DarkModeResponse {}

message WiFiRequest { string appId = 1; }
message WiFiResponse {}

message CellularRequest { string appId = 1; }
message CellularResponse {}

message GetNativeWidgetsRequest { Selector selector = 1; }
message GetNativeWidgetsResponse { repeated NativeWidget nativeWidgets = 1; }

message GetNotificationsRequest {}
message GetNotificationsResponse { repeated Notification notifications = 1; }

message TapRequest {
  Selector Selector = 1;
  string appId = 2;
}
message TapResponse {}

message EnterTextRequest {
  string data = 1;
  string appId = 2;

  oneof findBy {
    uint32 index = 3;
    Selector selector = 4;
  }
}
message EnterTextResponse {}

message SwipeRequest {
  float startX = 1;
  float startY = 2;
  float endX = 3;
  float endY = 4;
  uint32 steps = 5;
}
message SwipeResponse {}

message HandlePermissionRequest {
  Code code = 1;

  enum Code {
    WHILE_USING = 0;
    ONLY_THIS_TIME = 1;
    DENIED = 2;
  }
}
message HandlePermissionResponse {}

message SetLocationAccuracyRequest {
  LocationAccuracy locationAccuracy = 1;

  enum LocationAccuracy {
    COARSE = 0;
    FINE = 1;
  }
}
message SetLocationAccuracyResponse {}

message Selector {
  optional string text = 1;
  optional string textStartsWith = 2;
  optional string textContains = 3;
  optional string className = 4;
  optional string contentDescription = 5;
  optional string contentDescriptionStartsWith = 6;
  optional string contentDescriptionContains = 7;
  optional string resourceId = 8;
  optional uint32 instance = 9;
  optional bool enabled = 10;
  optional bool focused = 11;
  optional string pkg = 12;
}

// Represents a native UI control.
//
// On Android, this is `android.view.View`.
message NativeWidget {
  string className = 1;
  string text = 2;
  string contentDescription = 3;
  bool focused = 4;
  bool enabled = 5;
  int32 childCount = 6;
  string resourceName = 7;
  string applicationPackage = 8;
  repeated NativeWidget children = 9;
}

// Represents a notification visible in the notification shade.
message Notification {
  optional string appName = 1;
  string title = 2;
  string content = 3;
}
