#!/usr/bin/env bash

cd "$(dirname "$0")" || exit

SRC_DIR="."

dart_out="./packages/patrol/lib/src/native/contracts"
java_out="./AutomatorServer/android/app/src/androidTest/java"
kotlin_out="./AutomatorServer/android/app/src/androidTest/java"
swift_out="./AutomatorServer/ios/AutomatorServerUITests"

protoc --dart_out="grpc:$dart_out" -I="$SRC_DIR" "$SRC_DIR/contracts.proto"

java_plugin_path="$HOME/Downloads/protoc-gen-grpc-java"
kotlin_plugin_path="$HOME/Downloads/protoc-gen-grpc-kotlin.sh"

protoc \
	--java_out="$java_out" \
	--kotlin_out="$kotlin_out" \
	--grpc-java_out="$java_out" \
    --grpckt_out="$kotlin_out" \
	--plugin=protoc-gen-grpc-java="$java_plugin_path" \
	--plugin=protoc-gen-grpckt="$kotlin_plugin_path" \
	"$SRC_DIR/contracts.proto"

protoc \
	--swift_out="$swift_out" \
	--grpc-swift_out="$swift_out" \
	--swift_opt=Visibility=Public \
	"$SRC_DIR/contracts.proto"
