#!/usr/bin/env bash
set -euo pipefail
cd "$(dirname "$0")"

# This script assumes that APKs are already built.

RESULTS_DIR_NAME="$(date +"%Y-%m-%d_%H:%M:%S")"
echo "RESULTS_DIR_NAME=$RESULTS_DIR_NAME" >> "$GITHUB_ENV"

exec gcloud firebase test android run \
	--type instrumentation \
	--app build/app/outputs/apk/debug/app-debug.apk \
	--test build/app/outputs/apk/androidTest/debug/app-debug-androidTest.apk \
	--device model=oriole,version=33,locale=en,orientation=portrait \
	--timeout 10m \
	--results-bucket="patrol_runs" \
	--results-dir="$RESULTS_DIR_NAME" \
	--use-orchestrator \
	--environment-variables clearPackageData=true,packageName="pl.leancode.patrol.example"  
	# --device model=oriole,version=31,locale=en,orientation=portrait \
