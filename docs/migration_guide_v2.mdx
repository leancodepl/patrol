---
title: V2 migration guide
---

# Migration guide to v2

Patrol v2 is the new major version Patrol.

Unfortunately, some breaking changes couldn't be avoided, but they're rather
minor and mostly concern boilerplate and configuration files. The good news is
that code of tests written in Dart stays the same (with some exceptions).

## Common

- Update the dependency in `pubspec.yaml`:

  ```yaml
  dev_dependencies:
    patrol: ^2.0.0
  ```

- Make sure you're using the newest version of Patrol CLI. It should begin with
  v2:

  ```console
  $ patrol --version
  patrol_cli v2.0.0
  ```

## Android

### MainActivityTest.java

Contents of this file have to be replaced. It's located your application's
**android/app/src/androidTest/java/com/example/myapp/** directory (replacing
com, example, and myapp with values from your app's package name).

```java name="MainActivityTest.java"
package pl.leancode.patrol.example; // replace "pl.leancode.patrol.example" with your app's package

import org.junit.Test;
import org.junit.runner.RunWith;
import org.junit.runners.Parameterized;
import org.junit.runners.Parameterized.Parameters;
import pl.leancode.patrol.PatrolJUnitRunner;

@RunWith(Parameterized.class)
public class MainActivityTest {
    @Parameters(name = "{0}")
    public static Object[] testCases() {
        PatrolJUnitRunner.waitForPatrolAppService();
        return PatrolJUnitRunner.listDartTests();
    }

    public MainActivityTest(String dartTestName) {
        this.dartTestName = dartTestName;
    }

    private final String dartTestName;

    @Test
    public void runDartTest() {
        PatrolJUnitRunner.runDartTest(dartTestName);
    }
}
```

### build.gradle

A few changes are also needed in **app-level build.gradle**:

```groovy title="android/app/build.gradle"
android {
  // ...
  defaultConfig {
    //...
    testInstrumentationRunner "pl.leancode.patrol.PatrolJUnitRunner"
  }

  // ...

  testOptions {
    execution "ANDROIDX_TEST_ORCHESTRATOR"
  }
}

dependencies {
  androidTestUtil "androidx.test:orchestrator:1.4.2"
}
```

If you had `testImplementation "junit:junit:4.13.2"` (or similar) in
`dependencies` block, it should be removed.

## gitignore

The following file is generated by Patrol CLI and should be added to
`.gitignore`:

```
integration_test/test_bundle.dart
```

## iOS

On iOS, only one line has to be added in a single file:

```objective-c title="ios/RunnerUITests/RunnerUITests.m"
@import XCTest;
@import patrol;
@import ObjectiveC.runtime;

PATROL_INTEGRATION_TEST_IOS_RUNNER(RunnerUITests)
```

That's all!

## Caveats

There are a few, and all are kept track of in [this issue]. We intent to fix all
of them in future releases.

[this issue]: https://github.com/leancodepl/patrol/issues/1341
