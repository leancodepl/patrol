## Tips and tricks

## Running a test many times

Sometimes, you might want to run a test many times. In such case, we've got
these one-liners for you:

**Bash**

```console
$ for i in {1..10}; do patrol drive --target integration_test/my_test.dart; done
```

**PowerShell**

```powershell
1..10 | ForEach-Object { patrol drive --target integration_test/my_test.dart }
```

## Inspecting native view hierarchy

It's hard to tap on or enter text into something you don't know how to refer to.
It's heplful to do a native view hierarchy dump and find the properties of the
view you want to act on.

### Android

```console
$ adb shell uiautomator dump
```

Then, copy the dump file from the device to your machine:

```console
$ adb pull /sdcard/window_dump.xml .
```

### iOS

```console
$ idb ui describe-all
```

## Avoiding hardcoding credentials in tests

It's a bad practice to hardcode data such as emails, usernames, and passwords in
test code.

```dart
await $(#nameTextField).enterText('Bartek'); // bad!
await $(#passwordTextField).enterText('ny4ncat'); // bad as well!
```

To fix this, we recommend to remove the hardcoded credentials from test code and
provide them through the environemnt:

```dart
await $(#nameTextField).enterText(String.fromEnvironment('USERNAME'));
await $(#passwordTextField).enterText(String.fromEnvironment('PASSWORD'));
```

To set `USERNAME` and `PASSWORD`, use `--dart-define`:

```console
$ patrol drive --dart-define 'USERNAME=Bartek' --dart-define 'PASSWORD=ny4ncat'
```

## Granting `Do Not Disturb access` permission on Android

To tap on the `Camera toggle` and then to tap on the `ALLOW` use `$.native`

### Enable `nativeAutomation`
```dart
  patrolTest(nativeAutomation: true,
      ($) async {
```
Use `Selector` from `UIAutomator` (in this case `text` is used). 

More info about `Selector` capabilites https://developer.android.com/reference/androidx/test/uiautomator/UiSelector

```dart
await $.native.tap(Selector(text: 'Camera'));
await $.native.tap(Selector(text: 'ALLOW'));
await $.native.pressBack();
```
### Screenshot
![image](https://user-images.githubusercontent.com/10289319/194897313-849b8b84-df7a-4bf3-9b06-bb2782876d03.png)
