---
title: Migrating to Patrol 4.0
---

Patrol 4.0 introduces the **Platform Automation API** and starts the deprecation of the legacy native automation entry points:

- `$.native` (Native Automation 1.0)
- `$.native2` (Native Automation 2.0)

The recommended replacement is:

- `$.platform.mobile` for cross-platform (Android + iOS) mobile actions
- `$.platform.android` and `$.platform.ios` for platform-specific actions
- `$.platform.web` for web actions

<Warning>
  `$.native`, `$.native2`, `NativeAutomator`, `NativeAutomator2`, and `NativeAutomatorConfig` are deprecated and will be removed in a future release. Migrate to `$.platform` and `PlatformAutomatorConfig`.
</Warning>

## Quick checklist

- Upgrade the `patrol` package (and Patrol CLI) to 4.x.
- Rename your `integration_test/` directory to `patrol_test/` in `pubspec.yaml`, and update `.gitignore` accordingly.
- Rewrite `$.native.*` and `$.native2.*` calls to `$.platform.*`.
- Replace `NativeSelector(...)` with `MobileSelector(...)`, `Selector(...)`, or `PlatformSelector(...)`.
- `patrol test` and `patrol develop` now prompt for a device. In CI, pass `--device`/`-d` to avoid the prompt, or set `CI=true` env variable.

## Breaking changes you’ll likely hit

### `$.native` and `$.native2` are deprecated

In Patrol 4.0 you should use `$.platform` as your entry point to platform automation.

- `$.platform.mobile`: cross-platform mobile actions (recommended default)
- `$.platform.android`: Android-only actions
- `$.platform.ios`: iOS-only actions
- `$.platform.web`: web automation

## Common rewrites (copy/paste)

### `native2` → `platform.mobile`

#### Pressing Home

```dart
await $.native2.pressHome(); // Press home for notifications.
await $.platform.mobile.pressHome(); // Press home for notifications.
```

#### Selectors: `NativeSelector` → `MobileSelector`

Most `native2` methods used `NativeSelector(...)`. The Patrol 4.0 equivalent is `MobileSelector(...)` passed to `$.platform.mobile.*`.

Before:

```dart
await $.native2.tap(
  NativeSelector(
    android: AndroidSelector(resourceName: 'com.example:id/submit_button'),
    ios: IOSSelector(identifier: 'submitButton'),
  ),
);
```

After:

```dart
await $.platform.mobile.tap(
  MobileSelector(
    android: AndroidSelector(resourceName: 'com.example:id/submit_button'),
    ios: IOSSelector(identifier: 'submitButton'),
  ),
);
```

#### Selector types you can pass to `$.platform.mobile.tap()`

Patrol 4.0 native actions (for example `$.platform.mobile.tap(...)`) accept a `CompoundSelector`. In practice, you’ll usually use one of these three types:

#### `MobileSelector(...)` (most common during migration)

Use when Android and iOS require different selectors (this is the direct replacement for most `native2` uses).

```dart
await $.platform.mobile.tap(
  MobileSelector(
    android: AndroidSelector(resourceName: 'com.example:id/submit_button'),
    ios: IOSSelector(identifier: 'submitButton'),
  ),
);
```

#### `Selector(...)`

Use when the same selector “shape” works on Android and iOS (for example text-based selectors).

```dart
await $.platform.mobile.tap(Selector(text: 'Allow'));
```

#### `PlatformSelector(...)`

Use when you want to provide selectors for Android + iOS + Web in one place. This is most useful with `$.platform.tap(...)` (platform router), but it can also be used with `$.platform.mobile.*` as long as it includes Android and iOS selectors.

```dart
await $.platform.tap(
  PlatformSelector(
    android: AndroidSelector(text: 'Click me'),
    ios: IOSSelector(text: 'Click me'),
    web: WebSelector(text: 'Click me'),
  ),
);
```

#### Platform-specific actions

Some legacy calls were platform-specific but lived under `$.native`. In Patrol 4.0 they live under `$.platform.android` / `$.platform.ios`.

```dart
// Android-only
await $.native.pressBack();
await $.platform.android.pressBack();

// iOS-only
await $.native.closeHeadsUpNotification();
await $.platform.ios.closeHeadsUpNotification();
```
## More examples

### NativeAutomator → PlatformAutomator
If you used to create native automators manually, create a `PlatformAutomator` instead.

**Before:**

```dart
patrolTearDown(() async {
  final automator = NativeAutomator(config: nativeConfig);

  await automator.enableWifi();
  await automator.enableCellular();
});
```

**After:**

```dart
patrolTearDown(() async {
  final automator = PlatformAutomator(config: platformConfig);

  await automator.mobile.enableWifi();
  await automator.mobile.enableCellular();
});
```

### NativeAutomatorConfig → PlatformAutomatorConfig

**Before (legacy):**

```dart
final nativeConfig = NativeAutomatorConfig(
  keyboardBehavior: KeyboardBehavior.alternative,
);
```

**After:**

```dart
final platformConfig = PlatformAutomatorConfig.fromOptions(
  keyboardBehavior: KeyboardBehavior.alternative,
);
```
